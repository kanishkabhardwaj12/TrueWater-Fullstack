/**
 * @fileoverview Firestore Security Rules for the TrueWater Algae Insights application.
 *
 * Core Philosophy:
 * This ruleset allows public read access to all data and allows any user to create
 * new water samples. This ensures data can be publicly viewed and new samples can be
 * submitted by anyone, but existing data cannot be altered or deleted.
 *
 * Data Structure:
 * The data is organized into a two-level hierarchy: `/waterSamples/{waterSampleId}` and `/waterSamples/{waterSampleId}/algaeClassifications/{classificationId}`.
 *
 * Key Security Decisions:
 * - Public Read Access: All users, even unauthenticated ones, can read the water sample and algae classification data.
 * - Public Create Access: Any user can create new water sample documents.
 * - No Updates or Deletes: No user can update or delete existing data.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Grants public read and create access to water sample data.
     * @path /waterSamples/{waterSampleId}
     * @allow (get, list, create): Any user can read or create water sample data.
     * @allow (update, delete): No user can modify or delete sample data.
     * @principle Allows public data submission and retrieval while protecting data integrity.
     */
    match /waterSamples/{waterSampleId} {
      allow get, list: if true;
      allow create: if true;
      allow update, delete: if false;
    }

    /**
     * @description Grants public read access to algae classification data. Writes are disallowed.
     * @path /waterSamples/{waterSampleId}/algaeClassifications/{classificationId}
     * @allow (get, list): Any user can read algae classification data.
     * @allow (create, update, delete): Nobody can write to this subcollection directly. It is part of the parent document.
     * @principle Allows public data retrieval while ensuring data is only added via the parent sample.
     */
    match /waterSamples/{waterSampleId}/algaeClassifications/{classificationId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }
  }
}
